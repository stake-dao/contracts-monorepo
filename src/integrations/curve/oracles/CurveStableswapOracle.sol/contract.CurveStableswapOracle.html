<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CurveStableswapOracle - Stake DAO Staking v2</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../../../favicon.svg">
        <link rel="shortcut icon" href="../../../../../favicon.png">
        <link rel="stylesheet" href="../../../../../css/variables.css">
        <link rel="stylesheet" href="../../../../../css/general.css">
        <link rel="stylesheet" href="../../../../../css/chrome.css">
        <link rel="stylesheet" href="../../../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../../../highlight.css">
        <link rel="stylesheet" href="../../../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../../../book.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../../../index.html">README</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/index.html"><strong aria-hidden="true">1.</strong> integrations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/index.html"><strong aria-hidden="true">1.1.</strong> curve</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/L2/index.html"><strong aria-hidden="true">1.1.1.</strong> L2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/L2/ConvexSidecarFactoryL2.sol/contract.ConvexSidecarFactoryL2.html"><strong aria-hidden="true">1.1.1.1.</strong> ConvexSidecarFactoryL2</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/L2/ConvexSidecarL2.sol/contract.ConvexSidecarL2.html"><strong aria-hidden="true">1.1.1.2.</strong> ConvexSidecarL2</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/L2/CurveFactoryL2.sol/contract.CurveFactoryL2.html"><strong aria-hidden="true">1.1.1.3.</strong> CurveFactoryL2</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/L2/CurveStrategyL2.sol/contract.CurveStrategyL2.html"><strong aria-hidden="true">1.1.1.4.</strong> CurveStrategyL2</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/lending/index.html"><strong aria-hidden="true">1.1.2.</strong> lending</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/lending/CurveLendingMarketFactory.sol/contract.CurveLendingMarketFactory.html"><strong aria-hidden="true">1.1.2.1.</strong> CurveLendingMarketFactory</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/oracles/index.html"><strong aria-hidden="true">1.1.3.</strong> oracles</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/oracles/BaseOracle.sol/abstract.BaseOracle.html"><strong aria-hidden="true">1.1.3.1.</strong> BaseOracle</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/oracles/CurveCryptoswapOracle.sol/contract.CurveCryptoswapOracle.html"><strong aria-hidden="true">1.1.3.2.</strong> CurveCryptoswapOracle</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/oracles/CurveStableswapOracle.sol/contract.CurveStableswapOracle.html" class="active"><strong aria-hidden="true">1.1.3.3.</strong> CurveStableswapOracle</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/ConvexSidecar.sol/contract.ConvexSidecar.html"><strong aria-hidden="true">1.1.4.</strong> ConvexSidecar</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/ConvexSidecarFactory.sol/contract.ConvexSidecarFactory.html"><strong aria-hidden="true">1.1.5.</strong> ConvexSidecarFactory</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/CurveFactory.sol/contract.CurveFactory.html"><strong aria-hidden="true">1.1.6.</strong> CurveFactory</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/CurveStrategy.sol/contract.CurveStrategy.html"><strong aria-hidden="true">1.1.7.</strong> CurveStrategy</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/curve/OnlyBoostAllocator.sol/contract.OnlyBoostAllocator.html"><strong aria-hidden="true">1.1.8.</strong> OnlyBoostAllocator</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/morpho/index.html"><strong aria-hidden="true">1.2.</strong> morpho</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/integrations/morpho/MorphoMarketFactory.sol/contract.MorphoMarketFactory.html"><strong aria-hidden="true">1.2.1.</strong> MorphoMarketFactory</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/pendle/index.html"><strong aria-hidden="true">1.3.</strong> pendle</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/integrations/pendle/PendleAllocator.sol/contract.PendleAllocator.html"><strong aria-hidden="true">1.3.1.</strong> PendleAllocator</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/pendle/PendleFactory.sol/contract.PendleFactory.html"><strong aria-hidden="true">1.3.2.</strong> PendleFactory</a></li><li class="chapter-item expanded "><a href="../../../../../src/integrations/pendle/PendleStrategy.sol/contract.PendleStrategy.html"><strong aria-hidden="true">1.3.3.</strong> PendleStrategy</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/index.html"><strong aria-hidden="true">2.</strong> interfaces</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IAccountant.sol/interface.IAccountant.html"><strong aria-hidden="true">2.1.</strong> IAccountant</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IAllocator.sol/interface.IAllocator.html"><strong aria-hidden="true">2.2.</strong> IAllocator</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IBalanceProvider.sol/interface.IBalanceProvider.html"><strong aria-hidden="true">2.3.</strong> IBalanceProvider</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IChainlinkFeed.sol/interface.IChainlinkFeed.html"><strong aria-hidden="true">2.4.</strong> IChainlinkFeed</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/ICurvePool.sol/interface.ICurvePool.html"><strong aria-hidden="true">2.5.</strong> ICurvePool</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/ICurvePool.sol/interface.ICurveStableSwapPool.html"><strong aria-hidden="true">2.6.</strong> ICurveStableSwapPool</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/ICurvePool.sol/interface.ICurveCryptoSwapPool.html"><strong aria-hidden="true">2.7.</strong> ICurveCryptoSwapPool</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IFactory.sol/interface.IFactory.html"><strong aria-hidden="true">2.8.</strong> IFactory</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/ILendingFactory.sol/interface.ILendingFactory.html"><strong aria-hidden="true">2.9.</strong> ILendingFactory</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IOracle.sol/interface.IOracle.html"><strong aria-hidden="true">2.10.</strong> IOracle</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IPendleGauge.sol/interface.IPendleGauge.html"><strong aria-hidden="true">2.11.</strong> IPendleGauge</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IPendleGaugeController.sol/interface.IPendleGaugeController.html"><strong aria-hidden="true">2.12.</strong> IPendleGaugeController</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IPendleMarket.sol/interface.IPendleMarket.html"><strong aria-hidden="true">2.13.</strong> IPendleMarket</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IProtocolController.sol/interface.IProtocolController.html"><strong aria-hidden="true">2.14.</strong> IProtocolController</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IRewardReceiver.sol/interface.IRewardReceiver.html"><strong aria-hidden="true">2.15.</strong> IRewardReceiver</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IRewardVault.sol/interface.IRewardVault.html"><strong aria-hidden="true">2.16.</strong> IRewardVault</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IRouter.sol/interface.IRouter.html"><strong aria-hidden="true">2.17.</strong> IRouter</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IRouterModule.sol/interface.IRouterModule.html"><strong aria-hidden="true">2.18.</strong> IRouterModule</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/ISidecar.sol/interface.ISidecar.html"><strong aria-hidden="true">2.19.</strong> ISidecar</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/ISidecarFactory.sol/interface.ISidecarFactory.html"><strong aria-hidden="true">2.20.</strong> ISidecarFactory</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IStrategy.sol/interface.IStrategy.html"><strong aria-hidden="true">2.21.</strong> IStrategy</a></li><li class="chapter-item expanded "><a href="../../../../../src/interfaces/IStrategyWrapper.sol/interface.IStrategyWrapper.html"><strong aria-hidden="true">2.22.</strong> IStrategyWrapper</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/libraries/index.html"><strong aria-hidden="true">3.</strong> libraries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/libraries/ImmutableArgsParser.sol/library.ImmutableArgsParser.html"><strong aria-hidden="true">3.1.</strong> ImmutableArgsParser</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/merkl/index.html"><strong aria-hidden="true">4.</strong> merkl</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/merkl/UniversalBoostRegistry.sol/contract.UniversalBoostRegistry.html"><strong aria-hidden="true">4.1.</strong> UniversalBoostRegistry</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/router/index.html"><strong aria-hidden="true">5.</strong> router</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/router/RouterIdentifierMapping.sol/library.RouterIdentifierMapping.html"><strong aria-hidden="true">5.1.</strong> RouterIdentifierMapping</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleClaim.sol/contract.RouterModuleClaim.html"><strong aria-hidden="true">5.2.</strong> RouterModuleClaim</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleDeposit.sol/contract.RouterModuleDeposit.html"><strong aria-hidden="true">5.3.</strong> RouterModuleDeposit</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleMigrationCurve.sol/contract.RouterModuleMigrationCurve.html"><strong aria-hidden="true">5.4.</strong> RouterModuleMigrationCurve</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleMigrationStakeDAOV1.sol/interface.IVault.html"><strong aria-hidden="true">5.5.</strong> IVault</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleMigrationStakeDAOV1.sol/contract.RouterModuleMigrationStakeDAOV1.html"><strong aria-hidden="true">5.6.</strong> RouterModuleMigrationStakeDAOV1</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleMigrationYearn.sol/contract.RouterModuleMigrationYearn.html"><strong aria-hidden="true">5.7.</strong> RouterModuleMigrationYearn</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleMigrationYearn.sol/interface.IYearnVault.html"><strong aria-hidden="true">5.8.</strong> IYearnVault</a></li><li class="chapter-item expanded "><a href="../../../../../src/router/RouterModuleWithdraw.sol/contract.RouterModuleWithdraw.html"><strong aria-hidden="true">5.9.</strong> RouterModuleWithdraw</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/wrappers/index.html"><strong aria-hidden="true">6.</strong> wrappers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../../../../src/wrappers/StrategyWrapper.sol/interface.IAccountant.html"><strong aria-hidden="true">6.1.</strong> IAccountant</a></li><li class="chapter-item expanded "><a href="../../../../../src/wrappers/StrategyWrapper.sol/contract.StrategyWrapper.html"><strong aria-hidden="true">6.2.</strong> StrategyWrapper</a></li></ol></li><li class="chapter-item expanded "><a href="../../../../../src/Accountant.sol/contract.Accountant.html"><strong aria-hidden="true">7.</strong> Accountant</a></li><li class="chapter-item expanded "><a href="../../../../../src/Allocator.sol/contract.Allocator.html"><strong aria-hidden="true">8.</strong> Allocator</a></li><li class="chapter-item expanded "><a href="../../../../../src/Factory.sol/abstract.Factory.html"><strong aria-hidden="true">9.</strong> Factory</a></li><li class="chapter-item expanded "><a href="../../../../../src/ProtocolContext.sol/contract.ProtocolContext.html"><strong aria-hidden="true">10.</strong> ProtocolContext</a></li><li class="chapter-item expanded "><a href="../../../../../src/ProtocolController.sol/contract.ProtocolController.html"><strong aria-hidden="true">11.</strong> ProtocolController</a></li><li class="chapter-item expanded "><a href="../../../../../src/RewardReceiver.sol/contract.RewardReceiver.html"><strong aria-hidden="true">12.</strong> RewardReceiver</a></li><li class="chapter-item expanded "><a href="../../../../../src/RewardReceiverL2.sol/contract.RewardReceiverL2.html"><strong aria-hidden="true">13.</strong> RewardReceiverL2</a></li><li class="chapter-item expanded "><a href="../../../../../src/RewardVault.sol/contract.RewardVault.html"><strong aria-hidden="true">14.</strong> RewardVault</a></li><li class="chapter-item expanded "><a href="../../../../../src/Router.sol/contract.Router.html"><strong aria-hidden="true">15.</strong> Router</a></li><li class="chapter-item expanded "><a href="../../../../../src/Sidecar.sol/abstract.Sidecar.html"><strong aria-hidden="true">16.</strong> Sidecar</a></li><li class="chapter-item expanded "><a href="../../../../../src/SidecarFactory.sol/abstract.SidecarFactory.html"><strong aria-hidden="true">17.</strong> SidecarFactory</a></li><li class="chapter-item expanded "><a href="../../../../../src/Strategy.sol/abstract.Strategy.html"><strong aria-hidden="true">18.</strong> Strategy</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Stake DAO Staking v2</h1>

                    <div class="right-buttons">
                        <a href="../../../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/stake-dao/contracts-monorepo" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="curvestableswaporacle"><a class="header" href="#curvestableswaporacle">CurveStableswapOracle</a></h1>
<p><a href="https://github.com/stake-dao/contracts-monorepo/blob/094552b4e36adae9cc47e327b422772be9e81e83/src/integrations/curve/oracles/CurveStableswapOracle.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
<a href="/src/integrations/curve/oracles/BaseOracle.sol/abstract.BaseOracle.html">BaseOracle</a></p>
<p>Read-only price oracle that returns the value of one Curve
StableSwap** LP token expressed in an arbitrary <strong>loan
asset</strong> (USDC, crvUSD, USDT, …).
The oracle is intended for lending markets (Morpho etc.) where the LP token is
used as collateral and the loan asset is the unit in which debts are
denominated.
Supported pool families: <strong>StableSwap</strong> pools and <strong>StableSwap-NG</strong> pools
that implement the <code>price_oracle()</code> method.</p>
<h2 id="pricing-formula"><a class="header" href="#pricing-formula">*Pricing formula</a></h2>
<h2>Price(LP / Loan) = min(price_oracle(i)) × get_virtual_price()    ⎫ in coin0
× Π price(hopᵢ)                                ⎬ coin0 → USD
÷ price(Loan / USD)                            ⎭ USD    → Loan
• Uses Curve's EMA price oracle for conservative pricing across all pool assets
• <code>price_oracle(i)</code> returns the price of coin[i+1] relative to coin0 (18 decimals)
• <code>get_virtual_price()</code> returns the LP token price in coin0 terms (18 decimals)
• <code>token0ToUsdFeeds</code> is an ordered array of Chainlink feeds that, hop by hop,
convert coin0 into USD. Each element consumes the output of the previous hop.
Flash-manipulation caveat</h2>
<h2>This oracle leverages Curve's battle-tested EMA price oracle which provides
protection against flash loan attacks through exponential moving average smoothing.
The conservative minimum pricing across all pool assets prevents overvaluation
during asset depegs. This oracle is intended for high-TVL, curated pools only.
Conservative LLTV settings are still recommended for additional safety.
Feed availability and adapter pattern</h2>
<h2>When coin0 ≠ loan asset, the oracle requires a hop-chain to convert coin0 to USD.
Each hop in the chain can return prices in any denomination - the chain composition
determines the final USD conversion.
Optional Loan Asset Feed</h2>
<h2>When coin0 = loan asset, no external feeds are required and the oracle
provides direct pricing with optimal gas efficiency.
Limitations – Pool Compatibility</h2>
<h2>This oracle only supports pools that implement the <code>price_oracle()</code> method.
Pools without this method are incompatible and will revert during deployment.
The oracle automatically detects pool configuration and supports both:
• 2-coin pools: <code>price_oracle()</code> (no arguments)
• Multi-coin pools: <code>price_oracle(i)</code> (with coin index argument)
Limitations – Layer 2 sequencer availability</h2>
<p>This oracle lacks sequencer uptime validation for Layer 2 networks. Chainlink
feeds on L2s can become stale if the sequencer goes down. For L2 deployments,
consider wrapping this oracle to include Sequencer Uptime Data Feed checks.
https://docs.chain.link/data-feeds/l2-sequencer-feeds
When coin0 = loan asset, no external feeds are required and the oracle
provides direct pricing with optimal gas efficiency.*</p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="no_argument"><a class="header" href="#no_argument">NO_ARGUMENT</a></h3>
<p><em>Define if the price_oracle() method takes no arguments</em></p>
<pre><code class="language-solidity">bool internal immutable NO_ARGUMENT;
</code></pre>
<h3 id="n_coins"><a class="header" href="#n_coins">N_COINS</a></h3>
<p><em>Define the number of coins in the pool</em></p>
<pre><code class="language-solidity">uint256 internal immutable N_COINS;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>reverts: ZeroAddress if <code>_curvePool</code>, <code>_collateralToken</code>, <code>_loanAsset</code>, or <code>_loanAssetFeed</code> is the zero address.</p>
</li>
<li>
<p>reverts: ZeroUint256 if <code>_loanAssetFeedHeartbeat</code> is zero or if no pool asset feeds are provided.</p>
</li>
<li>
<p>reverts: ArrayLengthMismatch if feed and heartbeat arrays have different lengths.</p>
</li>
</ul>
<pre><code class="language-solidity">constructor(
    address _curvePool,
    address _collateralToken,
    address _loanAsset,
    address _loanAssetFeed,
    uint256 _loanAssetFeedHeartbeat,
    address[] memory _token0ToUsdFeeds,
    uint256[] memory _token0ToUsdHeartbeats
)
    BaseOracle(
        _curvePool,
        _collateralToken,
        _loanAsset,
        _loanAssetFeed,
        _loanAssetFeedHeartbeat,
        _token0ToUsdFeeds,
        _token0ToUsdHeartbeats
    );
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_curvePool</code></td><td><code>address</code></td><td>The address of the Curve pool for the LP token collateral.</td></tr>
<tr><td><code>_collateralToken</code></td><td><code>address</code></td><td>The address of the collateral token of the lending market.</td></tr>
<tr><td><code>_loanAsset</code></td><td><code>address</code></td><td>The address of the loan token of the lending market (e.g., USDC/crvUSD).</td></tr>
<tr><td><code>_loanAssetFeed</code></td><td><code>address</code></td><td>The address of the Chainlink feed for the loan token of the lending market (e.g., USDC/crvUSD).</td></tr>
<tr><td><code>_loanAssetFeedHeartbeat</code></td><td><code>uint256</code></td><td>The maximum number of seconds since the last update of the loan asset feed.</td></tr>
<tr><td><code>_token0ToUsdFeeds</code></td><td><code>address[]</code></td><td>Ordered feeds to convert token0 to USD.</td></tr>
<tr><td><code>_token0ToUsdHeartbeats</code></td><td><code>uint256[]</code></td><td>Max seconds between two updates of each feed.</td></tr>
</tbody></table>
</div>
<h3 id="_getlppriceincoin0"><a class="header" href="#_getlppriceincoin0">_getLpPriceInCoin0</a></h3>
<p>Gets the LP token price in coin0 terms using Curve's EMA price oracle</p>
<pre><code class="language-solidity">function _getLpPriceInCoin0() internal view override returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>lpPrice The LP token price in coin0 terms (18 decimals)</td></tr>
</tbody></table>
</div>
<h3 id="_detectpoolconfiguration"><a class="header" href="#_detectpoolconfiguration">_detectPoolConfiguration</a></h3>
<p>Detects the pool configuration by testing price_oracle() calls</p>
<pre><code class="language-solidity">function _detectPoolConfiguration(address pool) internal view returns (uint256 nCoins, bool noArgument);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>pool</code></td><td><code>address</code></td><td>The Curve pool address</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>nCoins</code></td><td><code>uint256</code></td><td>Number of coins in the pool</td></tr>
<tr><td><code>noArgument</code></td><td><code>bool</code></td><td>Whether price_oracle() takes no arguments</td></tr>
</tbody></table>
</div>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="poolmusthaveatleast2coins"><a class="header" href="#poolmusthaveatleast2coins">PoolMustHaveAtLeast2Coins</a></h3>
<pre><code class="language-solidity">error PoolMustHaveAtLeast2Coins();
</code></pre>
<h3 id="pooldoesnotsupportpriceoracle"><a class="header" href="#pooldoesnotsupportpriceoracle">PoolDoesNotSupportPriceOracle</a></h3>
<pre><code class="language-solidity">error PoolDoesNotSupportPriceOracle();
</code></pre>
<h3 id="poolincompatiblepriceoracleimplementation"><a class="header" href="#poolincompatiblepriceoracleimplementation">PoolIncompatiblePriceOracleImplementation</a></h3>
<pre><code class="language-solidity">error PoolIncompatiblePriceOracleImplementation();
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../../../src/integrations/curve/oracles/CurveCryptoswapOracle.sol/contract.CurveCryptoswapOracle.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../../../src/integrations/curve/ConvexSidecar.sol/contract.ConvexSidecar.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../../../src/integrations/curve/oracles/CurveCryptoswapOracle.sol/contract.CurveCryptoswapOracle.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../../../src/integrations/curve/ConvexSidecar.sol/contract.ConvexSidecar.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../../../elasticlunr.min.js"></script>
        <script src="../../../../../mark.min.js"></script>
        <script src="../../../../../searcher.js"></script>

        <script src="../../../../../clipboard.min.js"></script>
        <script src="../../../../../highlight.js"></script>
        <script src="../../../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../../../solidity.min.js"></script>


    </div>
    </body>
</html>
