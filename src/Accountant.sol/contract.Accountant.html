<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Accountant - Stake DAO Staking v2</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">README</a></li><li class="chapter-item expanded "><a href="../../src/integrations/index.html"><strong aria-hidden="true">1.</strong> integrations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/integrations/curve/index.html"><strong aria-hidden="true">1.1.</strong> curve</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/integrations/curve/L2/index.html"><strong aria-hidden="true">1.1.1.</strong> L2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/integrations/curve/L2/CurveFactory.sol/contract.CurveFactory.html"><strong aria-hidden="true">1.1.1.1.</strong> CurveFactory</a></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/L2/CurveStrategy.sol/contract.CurveStrategy.html"><strong aria-hidden="true">1.1.1.2.</strong> CurveStrategy</a></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/L2/L2ConvexSidecar.sol/contract.L2ConvexSidecar.html"><strong aria-hidden="true">1.1.1.3.</strong> L2ConvexSidecar</a></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/L2/L2ConvexSidecarFactory.sol/contract.L2ConvexSidecarFactory.html"><strong aria-hidden="true">1.1.1.4.</strong> L2ConvexSidecarFactory</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/ConvexSidecar.sol/contract.ConvexSidecar.html"><strong aria-hidden="true">1.1.2.</strong> ConvexSidecar</a></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/ConvexSidecarFactory.sol/contract.ConvexSidecarFactory.html"><strong aria-hidden="true">1.1.3.</strong> ConvexSidecarFactory</a></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/CurveFactory.sol/contract.CurveFactory.html"><strong aria-hidden="true">1.1.4.</strong> CurveFactory</a></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/CurveStrategy.sol/contract.CurveStrategy.html"><strong aria-hidden="true">1.1.5.</strong> CurveStrategy</a></li><li class="chapter-item expanded "><a href="../../src/integrations/curve/OnlyBoostAllocator.sol/contract.OnlyBoostAllocator.html"><strong aria-hidden="true">1.1.6.</strong> OnlyBoostAllocator</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/integrations/yieldnest/index.html"><strong aria-hidden="true">1.2.</strong> yieldnest</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/integrations/yieldnest/YieldnestAutocompoundedVault.sol/contract.YieldnestAutocompoundedVault.html"><strong aria-hidden="true">1.2.1.</strong> YieldnestAutocompoundedVault</a></li><li class="chapter-item expanded "><a href="../../src/integrations/yieldnest/YieldnestOFT.sol/contract.YieldnestOFT.html"><strong aria-hidden="true">1.2.2.</strong> YieldnestOFT</a></li><li class="chapter-item expanded "><a href="../../src/integrations/yieldnest/YieldnestOFTAdapter.sol/contract.YieldnestOFTAdapter.html"><strong aria-hidden="true">1.2.3.</strong> YieldnestOFTAdapter</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../src/interfaces/index.html"><strong aria-hidden="true">2.</strong> interfaces</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/interfaces/IAccountant.sol/interface.IAccountant.html"><strong aria-hidden="true">2.1.</strong> IAccountant</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IAllocator.sol/interface.IAllocator.html"><strong aria-hidden="true">2.2.</strong> IAllocator</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IBalanceProvider.sol/interface.IBalanceProvider.html"><strong aria-hidden="true">2.3.</strong> IBalanceProvider</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IProtocolController.sol/interface.IProtocolController.html"><strong aria-hidden="true">2.4.</strong> IProtocolController</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IRewardReceiver.sol/interface.IRewardReceiver.html"><strong aria-hidden="true">2.5.</strong> IRewardReceiver</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IRewardVault.sol/interface.IRewardVault.html"><strong aria-hidden="true">2.6.</strong> IRewardVault</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IRouter.sol/interface.IRouter.html"><strong aria-hidden="true">2.7.</strong> IRouter</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IRouterModule.sol/interface.IRouterModule.html"><strong aria-hidden="true">2.8.</strong> IRouterModule</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/ISidecar.sol/interface.ISidecar.html"><strong aria-hidden="true">2.9.</strong> ISidecar</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/ISidecarFactory.sol/interface.ISidecarFactory.html"><strong aria-hidden="true">2.10.</strong> ISidecarFactory</a></li><li class="chapter-item expanded "><a href="../../src/interfaces/IStrategy.sol/interface.IStrategy.html"><strong aria-hidden="true">2.11.</strong> IStrategy</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/libraries/index.html"><strong aria-hidden="true">3.</strong> libraries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/libraries/ImmutableArgsParser.sol/library.ImmutableArgsParser.html"><strong aria-hidden="true">3.1.</strong> ImmutableArgsParser</a></li><li class="chapter-item expanded "><a href="../../src/libraries/LayerZeroEID.sol/library.LayerZeroEID.html"><strong aria-hidden="true">3.2.</strong> LayerZeroEID</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/merkl/index.html"><strong aria-hidden="true">4.</strong> merkl</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/merkl/UniversalBoostRegistry.sol/contract.UniversalBoostRegistry.html"><strong aria-hidden="true">4.1.</strong> UniversalBoostRegistry</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/router/index.html"><strong aria-hidden="true">5.</strong> router</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../src/router/RouterIdentifierMapping.sol/library.RouterIdentifierMapping.html"><strong aria-hidden="true">5.1.</strong> RouterIdentifierMapping</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleClaim.sol/contract.RouterModuleClaim.html"><strong aria-hidden="true">5.2.</strong> RouterModuleClaim</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleDeposit.sol/contract.RouterModuleDeposit.html"><strong aria-hidden="true">5.3.</strong> RouterModuleDeposit</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleMigrationCurve.sol/contract.RouterModuleMigrationCurve.html"><strong aria-hidden="true">5.4.</strong> RouterModuleMigrationCurve</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleMigrationStakeDAOV1.sol/interface.IVault.html"><strong aria-hidden="true">5.5.</strong> IVault</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleMigrationStakeDAOV1.sol/contract.RouterModuleMigrationStakeDAOV1.html"><strong aria-hidden="true">5.6.</strong> RouterModuleMigrationStakeDAOV1</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleMigrationYearn.sol/contract.RouterModuleMigrationYearn.html"><strong aria-hidden="true">5.7.</strong> RouterModuleMigrationYearn</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleMigrationYearn.sol/interface.IYearnVault.html"><strong aria-hidden="true">5.8.</strong> IYearnVault</a></li><li class="chapter-item expanded "><a href="../../src/router/RouterModuleWithdraw.sol/contract.RouterModuleWithdraw.html"><strong aria-hidden="true">5.9.</strong> RouterModuleWithdraw</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/Accountant.sol/contract.Accountant.html" class="active"><strong aria-hidden="true">6.</strong> Accountant</a></li><li class="chapter-item expanded "><a href="../../src/Allocator.sol/contract.Allocator.html"><strong aria-hidden="true">7.</strong> Allocator</a></li><li class="chapter-item expanded "><a href="../../src/AutocompoundedVault.sol/contract.AutocompoundedVault.html"><strong aria-hidden="true">8.</strong> AutocompoundedVault</a></li><li class="chapter-item expanded "><a href="../../src/Factory.sol/abstract.Factory.html"><strong aria-hidden="true">9.</strong> Factory</a></li><li class="chapter-item expanded "><a href="../../src/ProtocolContext.sol/contract.ProtocolContext.html"><strong aria-hidden="true">10.</strong> ProtocolContext</a></li><li class="chapter-item expanded "><a href="../../src/ProtocolController.sol/contract.ProtocolController.html"><strong aria-hidden="true">11.</strong> ProtocolController</a></li><li class="chapter-item expanded "><a href="../../src/RewardReceiver.sol/contract.RewardReceiver.html"><strong aria-hidden="true">12.</strong> RewardReceiver</a></li><li class="chapter-item expanded "><a href="../../src/RewardVault.sol/contract.RewardVault.html"><strong aria-hidden="true">13.</strong> RewardVault</a></li><li class="chapter-item expanded "><a href="../../src/Router.sol/contract.Router.html"><strong aria-hidden="true">14.</strong> Router</a></li><li class="chapter-item expanded "><a href="../../src/Sidecar.sol/abstract.Sidecar.html"><strong aria-hidden="true">15.</strong> Sidecar</a></li><li class="chapter-item expanded "><a href="../../src/SidecarFactory.sol/abstract.SidecarFactory.html"><strong aria-hidden="true">16.</strong> SidecarFactory</a></li><li class="chapter-item expanded "><a href="../../src/Strategy.sol/abstract.Strategy.html"><strong aria-hidden="true">17.</strong> Strategy</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Stake DAO Staking v2</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/stake-dao/contracts-monorepo" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="accountant"><a class="header" href="#accountant">Accountant</a></h1>
<p><a href="https://github.com/stake-dao/contracts-monorepo/blob/989e5edb183c61c8cf449e55a36c99eab1562d90/src/Accountant.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ReentrancyGuardTransient, Ownable2Step, <a href="/src/interfaces/IAccountant.sol/interface.IAccountant.html">IAccountant</a></p>
<p>Central accounting system that tracks user balances and distributes rewards across all vaults</p>
<p>*Uses integral-based accounting for gas-efficient reward distribution:</p>
<ul>
<li>Rewards are tracked as integrals (cumulative reward per token)</li>
<li>User rewards = (current integral - last user integral) * user balance
Two reward distribution policies:</li>
<li>HARVEST: Claims rewards from gauge on every user action (higher gas, immediate rewards)</li>
<li>CHECKPOINT: Accumulates rewards in gauge until manual harvest, but users can claim
from the shared reward pool if tokens are available (cross-vault liquidity)*</li>
</ul>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="scaling_factor"><a class="header" href="#scaling_factor">SCALING_FACTOR</a></h3>
<p>Precision multiplier for integral calculations (1e27 for maximum precision)</p>
<p><em>Higher precision prevents rounding errors in reward distribution</em></p>
<pre><code class="language-solidity">uint128 public constant SCALING_FACTOR = 1e27;
</code></pre>
<h3 id="max_fee_percent"><a class="header" href="#max_fee_percent">MAX_FEE_PERCENT</a></h3>
<p>Maximum combined fee percentage to protect users (40%)</p>
<pre><code class="language-solidity">uint128 public constant MAX_FEE_PERCENT = 0.4e18;
</code></pre>
<h3 id="min_meaningful_rewards"><a class="header" href="#min_meaningful_rewards">MIN_MEANINGFUL_REWARDS</a></h3>
<p>Minimum rewards threshold to update integrals in CHECKPOINT mode</p>
<p><em>Prevents precision loss from tiny reward amounts</em></p>
<pre><code class="language-solidity">uint128 public constant MIN_MEANINGFUL_REWARDS = 1e18;
</code></pre>
<h3 id="protocol_controller"><a class="header" href="#protocol_controller">PROTOCOL_CONTROLLER</a></h3>
<p>Central registry for protocol components</p>
<pre><code class="language-solidity">IProtocolController public immutable PROTOCOL_CONTROLLER;
</code></pre>
<h3 id="reward_token"><a class="header" href="#reward_token">REWARD_TOKEN</a></h3>
<p>The reward token distributed by this accountant (e.g., CRV)</p>
<pre><code class="language-solidity">address public immutable REWARD_TOKEN;
</code></pre>
<h3 id="protocol_id"><a class="header" href="#protocol_id">PROTOCOL_ID</a></h3>
<p>Protocol identifier this accountant manages</p>
<pre><code class="language-solidity">bytes4 public immutable PROTOCOL_ID;
</code></pre>
<h3 id="default_protocol_fee"><a class="header" href="#default_protocol_fee">DEFAULT_PROTOCOL_FEE</a></h3>
<p>Default protocol fee charged on rewards (15%)</p>
<pre><code class="language-solidity">uint128 internal constant DEFAULT_PROTOCOL_FEE = 0.15e18;
</code></pre>
<h3 id="default_harvest_fee"><a class="header" href="#default_harvest_fee">DEFAULT_HARVEST_FEE</a></h3>
<p>Default harvest fee paid to harvesters (0.1%)</p>
<p><em>Expressed as 0.001 in decimal form (0.001 * 100% = 0.1%)</em></p>
<p><em>Compensates for gas costs when calling harvest() function</em></p>
<pre><code class="language-solidity">uint128 internal constant DEFAULT_HARVEST_FEE = 0.001e18;
</code></pre>
<h3 id="feesparams"><a class="header" href="#feesparams">feesParams</a></h3>
<p>The feesParams struct.</p>
<pre><code class="language-solidity">FeesParams public feesParams;
</code></pre>
<h3 id="protocolfeesaccrued"><a class="header" href="#protocolfeesaccrued">protocolFeesAccrued</a></h3>
<p>The total protocol fees collected but not yet claimed.</p>
<pre><code class="language-solidity">uint256 public protocolFeesAccrued;
</code></pre>
<h3 id="vaults"><a class="header" href="#vaults">vaults</a></h3>
<p>Supply of vaults.</p>
<p><em>Vault address -&gt; VaultData.</em></p>
<pre><code class="language-solidity">mapping(address vault =&gt; VaultData vaultData) public vaults;
</code></pre>
<h3 id="accounts"><a class="header" href="#accounts">accounts</a></h3>
<p>Balances of accounts per vault.</p>
<p><em>Vault address -&gt; Account address -&gt; AccountData.</em></p>
<pre><code class="language-solidity">mapping(address vault =&gt; mapping(address account =&gt; AccountData accountData)) public accounts;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="onlyallowed"><a class="header" href="#onlyallowed">onlyAllowed</a></h3>
<p>Restricts access to addresses with specific function permissions</p>
<p><em>Used for harvest() and other privileged operations</em></p>
<pre><code class="language-solidity">modifier onlyAllowed();
</code></pre>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Initializes the Accountant contract with owner, registry, and reward token.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>throws: OwnableInvalidOwner If the owner is the zero address.</p>
</li>
<li>
<p>throws: InvalidProtocolController If the protocol controller is the zero address.</p>
</li>
<li>
<p>throws: InvalidRewardToken If the reward token is the zero address.</p>
</li>
</ul>
<pre><code class="language-solidity">constructor(address _owner, address _registry, address _rewardToken, bytes4 _protocolId) Ownable(_owner);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_owner</code></td><td><code>address</code></td><td>The address of the contract owner.</td></tr>
<tr><td><code>_registry</code></td><td><code>address</code></td><td>The address of the registry contract.</td></tr>
<tr><td><code>_rewardToken</code></td><td><code>address</code></td><td>The address of the reward token.</td></tr>
<tr><td><code>_protocolId</code></td><td><code>bytes4</code></td><td>The bytes4 ID of the protocol</td></tr>
</tbody></table>
</div>
<h3 id="checkpoint"><a class="header" href="#checkpoint">checkpoint</a></h3>
<p>Updates user balances and distributes rewards on every vault action</p>
<p>*Core accounting function called by vaults during transfers, mints, and burns
Token Operations:</p>
<ul>
<li>Mint (from = 0): Increases supply, updates receiver's reward integral</li>
<li>Burn (to = 0): Decreases supply, updates sender's reward integral</li>
<li>Transfer: Updates both sender and receiver integrals
Reward Distribution Policies:</li>
<li>HARVEST: Claims rewards on every action, only protocol fee charged</li>
<li>CHECKPOINT: Accumulates rewards until harvest(), both fees charged
In CHECKPOINT, fees are reserved (not immediately accrued) to ensure
the harvester receives proper compensation when they eventually harvest*</li>
</ul>
<p><strong>Note:</strong>
throws: OnlyVault If caller is not the registered vault for the gauge.</p>
<pre><code class="language-solidity">function checkpoint(
    address gauge,
    address from,
    address to,
    uint128 amount,
    IStrategy.PendingRewards calldata pendingRewards,
    IStrategy.HarvestPolicy policy
) public nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>gauge</code></td><td><code>address</code></td><td>The underlying gauge address of the vault.</td></tr>
<tr><td><code>from</code></td><td><code>address</code></td><td>The source address (address(0) for minting).</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The destination address (address(0) for burning).</td></tr>
<tr><td><code>amount</code></td><td><code>uint128</code></td><td>The amount of tokens being transferred/minted/burned.</td></tr>
<tr><td><code>pendingRewards</code></td><td><code>IStrategy.PendingRewards</code></td><td>New rewards to be distributed to the vault.</td></tr>
<tr><td><code>policy</code></td><td><code>IStrategy.HarvestPolicy</code></td><td>The harvest policy to use.</td></tr>
</tbody></table>
</div>
<h3 id="checkpoint-1"><a class="header" href="#checkpoint-1">checkpoint</a></h3>
<p>Checkpoints the state of the vault on every account action.</p>
<p><em>This function is a wrapper of <code>checkpoint</code> that emits the <code>Referrer</code> event.</em></p>
<p><strong>Note:</strong>
throws: OnlyVault If caller is not the registered vault for the gauge.</p>
<pre><code class="language-solidity">function checkpoint(
    address gauge,
    address from,
    address to,
    uint128 amount,
    IStrategy.PendingRewards calldata pendingRewards,
    IStrategy.HarvestPolicy policy,
    address referrer
) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>gauge</code></td><td><code>address</code></td><td>The underlying gauge address of the vault.</td></tr>
<tr><td><code>from</code></td><td><code>address</code></td><td>The source address (address(0) for minting).</td></tr>
<tr><td><code>to</code></td><td><code>address</code></td><td>The destination address (address(0) for burning).</td></tr>
<tr><td><code>amount</code></td><td><code>uint128</code></td><td>The amount of tokens being transferred/minted/burned.</td></tr>
<tr><td><code>pendingRewards</code></td><td><code>IStrategy.PendingRewards</code></td><td>New rewards to be distributed to the vault.</td></tr>
<tr><td><code>policy</code></td><td><code>IStrategy.HarvestPolicy</code></td><td>The harvest policy to use.</td></tr>
<tr><td><code>referrer</code></td><td><code>address</code></td><td>The address of the referrer.</td></tr>
</tbody></table>
</div>
<h3 id="_updateaccountstate"><a class="header" href="#_updateaccountstate">_updateAccountState</a></h3>
<p><em>Updates account state during operations.</em></p>
<pre><code class="language-solidity">function _updateAccountState(address vault, address account, uint128 amount, bool isDecrease, uint256 currentIntegral)
    private;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address.</td></tr>
<tr><td><code>account</code></td><td><code>address</code></td><td>The account to update.</td></tr>
<tr><td><code>amount</code></td><td><code>uint128</code></td><td>The amount to add/subtract.</td></tr>
<tr><td><code>isDecrease</code></td><td><code>bool</code></td><td>Whether to decrease (true) or increase (false) the balance.</td></tr>
<tr><td><code>currentIntegral</code></td><td><code>uint256</code></td><td>The current reward integral to checkpoint against.</td></tr>
</tbody></table>
</div>
<h3 id="totalsupply"><a class="header" href="#totalsupply">totalSupply</a></h3>
<p>Returns the total supply of tokens in a vault.</p>
<pre><code class="language-solidity">function totalSupply(address vault) external view returns (uint128);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint128</code></td><td>_ The total supply of tokens in the vault.</td></tr>
</tbody></table>
</div>
<h3 id="balanceof"><a class="header" href="#balanceof">balanceOf</a></h3>
<p>Returns the token balance of an account in a vault.</p>
<pre><code class="language-solidity">function balanceOf(address vault, address account) external view returns (uint128);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query.</td></tr>
<tr><td><code>account</code></td><td><code>address</code></td><td>The account address to check.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint128</code></td><td>_ The account's token balance in the vault.</td></tr>
</tbody></table>
</div>
<h3 id="getpendingrewards"><a class="header" href="#getpendingrewards">getPendingRewards</a></h3>
<p>Returns the pending rewards for a vault.</p>
<pre><code class="language-solidity">function getPendingRewards(address vault) external view returns (uint128);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint128</code></td><td>The pending rewards for the vault.</td></tr>
</tbody></table>
</div>
<h3 id="getpendingrewards-1"><a class="header" href="#getpendingrewards-1">getPendingRewards</a></h3>
<p>Returns the pending rewards for an account in a vault.</p>
<pre><code class="language-solidity">function getPendingRewards(address vault, address account) external view returns (uint256);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>vault</code></td><td><code>address</code></td><td>The vault address to query.</td></tr>
<tr><td><code>account</code></td><td><code>address</code></td><td>The account address to check.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>_ The pending rewards for the account in the vault.</td></tr>
</tbody></table>
</div>
<h3 id="harvest"><a class="header" href="#harvest">harvest</a></h3>
<p>Harvests rewards from multiple gauges and distributes them to vaults</p>
<p><em>Called by harvesters to claim rewards from external protocols and update integrals</em></p>
<p><strong>Note:</strong>
throws: InvalidHarvestDataLength If array lengths don't match</p>
<pre><code class="language-solidity">function harvest(address[] calldata _gauges, bytes[] calldata _harvestData, address _receiver) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gauges</code></td><td><code>address[]</code></td><td>Array of gauges to harvest from</td></tr>
<tr><td><code>_harvestData</code></td><td><code>bytes[]</code></td><td>Protocol-specific data for harvesting each gauge</td></tr>
<tr><td><code>_receiver</code></td><td><code>address</code></td><td>Address that will receive the harvest fee as compensation</td></tr>
</tbody></table>
</div>
<h3 id="_harvest"><a class="header" href="#_harvest">_harvest</a></h3>
<p><em>Batch harvests rewards and updates vault integrals</em></p>
<p>*Gas optimizations:</p>
<ol>
<li>Single strategy.flush() call at the end for all rewards</li>
<li>One token transfer for all harvested rewards</li>
<li>Defers rewards using transient storage during harvest*</li>
</ol>
<pre><code class="language-solidity">function _harvest(address[] memory _gauges, bytes[] memory harvestData, address receiver) internal nonReentrant;
</code></pre>
<h3 id="getharvestfeepercent"><a class="header" href="#getharvestfeepercent">getHarvestFeePercent</a></h3>
<p>Returns the current harvest fee percentage.</p>
<pre><code class="language-solidity">function getHarvestFeePercent() public view returns (uint128);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint128</code></td><td>_ The harvest fee percentage.</td></tr>
</tbody></table>
</div>
<h3 id="setharvestfeepercent"><a class="header" href="#setharvestfeepercent">setHarvestFeePercent</a></h3>
<p>Updates the harvest fee percentage.</p>
<p><strong>Note:</strong>
throws: FeeExceedsMaximum If fee would exceed maximum.</p>
<pre><code class="language-solidity">function setHarvestFeePercent(uint128 newHarvestFeePercent) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newHarvestFeePercent</code></td><td><code>uint128</code></td><td>New harvest fee percentage (scaled by 1e18).</td></tr>
</tbody></table>
</div>
<h3 id="claim"><a class="header" href="#claim">claim</a></h3>
<p>Claims rewards from multiple vaults for the caller</p>
<p><em>In CHECKPOINT mode, can claim if rewards are available in the contract</em></p>
<p><strong>Note:</strong>
throws: NoPendingRewards If there are no rewards to claim</p>
<pre><code class="language-solidity">function claim(address[] calldata _gauges, bytes[] calldata harvestData) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gauges</code></td><td><code>address[]</code></td><td>Array of gauges to claim rewards from</td></tr>
<tr><td><code>harvestData</code></td><td><code>bytes[]</code></td><td>Optional: triggers harvest before claim if provided</td></tr>
</tbody></table>
</div>
<h3 id="claim-1"><a class="header" href="#claim-1">claim</a></h3>
<p>Claims rewards and sends to a specific receiver</p>
<p><em>Optionally harvests first if harvestData is provided</em></p>
<p><strong>Note:</strong>
throws: NoPendingRewards If there are no rewards to claim</p>
<pre><code class="language-solidity">function claim(address[] calldata _gauges, bytes[] calldata harvestData, address receiver) public;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gauges</code></td><td><code>address[]</code></td><td>Array of gauges to claim rewards from</td></tr>
<tr><td><code>harvestData</code></td><td><code>bytes[]</code></td><td>Optional harvest data (empty array to skip harvest)</td></tr>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>Address that will receive the claimed rewards</td></tr>
</tbody></table>
</div>
<h3 id="claim-2"><a class="header" href="#claim-2">claim</a></h3>
<p>Claims multiple vault rewards on behalf of an account.</p>
<p><em>expected to be called by authorized accounts only</em></p>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>throws: OnlyAllowed If caller is not allowed to claim on behalf of others.</p>
</li>
<li>
<p>throws: NoPendingRewards If there are no rewards to claim.</p>
</li>
</ul>
<pre><code class="language-solidity">function claim(address[] calldata _gauges, address account, bytes[] calldata harvestData) external;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gauges</code></td><td><code>address[]</code></td><td>Array of gauges to claim rewards from.</td></tr>
<tr><td><code>account</code></td><td><code>address</code></td><td>Address to claim rewards for.</td></tr>
<tr><td><code>harvestData</code></td><td><code>bytes[]</code></td><td>Optional harvest data for each gauge. Empty bytes for gauges that don't need harvesting.</td></tr>
</tbody></table>
</div>
<h3 id="claim-3"><a class="header" href="#claim-3">claim</a></h3>
<p>Claims multiple vault rewards on behalf of an account and sends them to a specific address.</p>
<p><em>expected to be called by authorized accounts only</em></p>
<p><strong>Notes:</strong></p>
<ul>
<li>
<p>throws: OnlyAllowed If caller is not allowed to claim on behalf of others.</p>
</li>
<li>
<p>throws: NoPendingRewards If there are no rewards to claim.</p>
</li>
</ul>
<pre><code class="language-solidity">function claim(address[] calldata _gauges, address account, bytes[] calldata harvestData, address receiver)
    public
    onlyAllowed;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gauges</code></td><td><code>address[]</code></td><td>Array of gauges to claim rewards from.</td></tr>
<tr><td><code>account</code></td><td><code>address</code></td><td>Address to claim rewards for.</td></tr>
<tr><td><code>harvestData</code></td><td><code>bytes[]</code></td><td>Optional harvest data for each gauge. Empty bytes for gauges that don't need harvesting.</td></tr>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>Address that will receive the claimed rewards.</td></tr>
</tbody></table>
</div>
<h3 id="_claim"><a class="header" href="#_claim">_claim</a></h3>
<p><em>Internal implementation of claim functionality.</em></p>
<p><strong>Note:</strong>
throws: NoPendingRewards If the total claimed amount is zero.</p>
<pre><code class="language-solidity">function _claim(address[] calldata _gauges, address account, address receiver) internal nonReentrant;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_gauges</code></td><td><code>address[]</code></td><td>Array of gauges to claim rewards from.</td></tr>
<tr><td><code>account</code></td><td><code>address</code></td><td>Address to claim rewards for.</td></tr>
<tr><td><code>receiver</code></td><td><code>address</code></td><td>Address that will receive the claimed rewards.</td></tr>
</tbody></table>
</div>
<h3 id="getprotocolfeepercent"><a class="header" href="#getprotocolfeepercent">getProtocolFeePercent</a></h3>
<p>Returns the current protocol fee percentage.</p>
<pre><code class="language-solidity">function getProtocolFeePercent() public view returns (uint128);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint128</code></td><td>_ The protocol fee percentage.</td></tr>
</tbody></table>
</div>
<h3 id="setprotocolfeepercent"><a class="header" href="#setprotocolfeepercent">setProtocolFeePercent</a></h3>
<p>Updates the protocol fee percentage.</p>
<p><strong>Note:</strong>
throws: FeeExceedsMaximum If fee would exceed maximum.</p>
<pre><code class="language-solidity">function setProtocolFeePercent(uint128 newProtocolFeePercent) external onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newProtocolFeePercent</code></td><td><code>uint128</code></td><td>New protocol fee percentage (scaled by 1e18).</td></tr>
</tbody></table>
</div>
<h3 id="claimprotocolfees"><a class="header" href="#claimprotocolfees">claimProtocolFees</a></h3>
<p>Claims accumulated protocol fees.</p>
<p><em>Transfers fees to the configured fee receiver.</em></p>
<p><strong>Note:</strong>
throws: NoFeeReceiver If the fee receiver is not set.</p>
<pre><code class="language-solidity">function claimProtocolFees() external nonReentrant;
</code></pre>
<h3 id="gettotalfeepercent"><a class="header" href="#gettotalfeepercent">getTotalFeePercent</a></h3>
<p>Returns the total fee percentage (protocol + harvest).</p>
<pre><code class="language-solidity">function getTotalFeePercent() external view returns (uint128);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint128</code></td><td>_ The total fee percentage.</td></tr>
</tbody></table>
</div>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="protocolfeesclaimed"><a class="header" href="#protocolfeesclaimed">ProtocolFeesClaimed</a></h3>
<p>Emitted when protocol fees are claimed.</p>
<pre><code class="language-solidity">event ProtocolFeesClaimed(uint256 amount);
</code></pre>
<h3 id="harvest-1"><a class="header" href="#harvest-1">Harvest</a></h3>
<p>Emitted when a vault harvests rewards.</p>
<pre><code class="language-solidity">event Harvest(
    address indexed vault, uint256 integral, uint256 supply, uint256 amount, uint256 protocolFee, uint256 harvesterFee
);
</code></pre>
<h3 id="checkpoint-2"><a class="header" href="#checkpoint-2">Checkpoint</a></h3>
<p>Emitted when a checkpoint is made.</p>
<pre><code class="language-solidity">event Checkpoint(
    address indexed vault,
    address indexed from,
    address indexed to,
    uint128 amount,
    uint256 integral,
    uint256 supply,
    IStrategy.HarvestPolicy policy
);
</code></pre>
<h3 id="accountcheckpoint"><a class="header" href="#accountcheckpoint">AccountCheckpoint</a></h3>
<p>Emitted when an account checkpoint is made.</p>
<pre><code class="language-solidity">event AccountCheckpoint(
    address indexed vault, address indexed account, uint128 balance, uint256 integral, uint256 pendingRewards
);
</code></pre>
<h3 id="rewardsclaimed"><a class="header" href="#rewardsclaimed">RewardsClaimed</a></h3>
<p>Emitted when a user claims rewards.</p>
<pre><code class="language-solidity">event RewardsClaimed(address indexed vault, address indexed account, address receiver, uint256 amount);
</code></pre>
<h3 id="protocolfeepercentset"><a class="header" href="#protocolfeepercentset">ProtocolFeePercentSet</a></h3>
<p>Emitted when the protocol fee percent is updated.</p>
<pre><code class="language-solidity">event ProtocolFeePercentSet(uint128 oldProtocolFeePercent, uint128 newProtocolFeePercent);
</code></pre>
<h3 id="harvestfeepercentset"><a class="header" href="#harvestfeepercentset">HarvestFeePercentSet</a></h3>
<p>Emitted when the harvest fee percent is updated.</p>
<pre><code class="language-solidity">event HarvestFeePercentSet(uint128 oldHarvestFeePercent, uint128 newHarvestFeePercent);
</code></pre>
<h3 id="referrer"><a class="header" href="#referrer">Referrer</a></h3>
<p>Emitted when a deposit is made via a referrer</p>
<pre><code class="language-solidity">event Referrer(address indexed referrer, address referree, uint128 assets);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>referrer</code></td><td><code>address</code></td><td>The address of the referrer</td></tr>
<tr><td><code>referree</code></td><td><code>address</code></td><td>The address of the referree (the address that receives the shares)</td></tr>
<tr><td><code>assets</code></td><td><code>uint128</code></td><td>The amount of assets deposited (1:1 with shares)</td></tr>
</tbody></table>
</div>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="onlyvault"><a class="header" href="#onlyvault">OnlyVault</a></h3>
<p>Error thrown when the caller is not a vault.</p>
<pre><code class="language-solidity">error OnlyVault();
</code></pre>
<h3 id="onlyallowed-1"><a class="header" href="#onlyallowed-1">OnlyAllowed</a></h3>
<p>Error thrown when the caller is not allowed.</p>
<pre><code class="language-solidity">error OnlyAllowed();
</code></pre>
<h3 id="nostrategy"><a class="header" href="#nostrategy">NoStrategy</a></h3>
<p>Error thrown when the strategy is not set.</p>
<pre><code class="language-solidity">error NoStrategy();
</code></pre>
<h3 id="nofeereceiver"><a class="header" href="#nofeereceiver">NoFeeReceiver</a></h3>
<p>Error thrown when the fee receiver is not set.</p>
<pre><code class="language-solidity">error NoFeeReceiver();
</code></pre>
<h3 id="nopendingrewards"><a class="header" href="#nopendingrewards">NoPendingRewards</a></h3>
<p>Error thrown when there are no pending rewards.</p>
<pre><code class="language-solidity">error NoPendingRewards();
</code></pre>
<h3 id="insufficientpendingrewards"><a class="header" href="#insufficientpendingrewards">InsufficientPendingRewards</a></h3>
<p>Error thrown when the pending rewards are not enough.</p>
<pre><code class="language-solidity">error InsufficientPendingRewards();
</code></pre>
<h3 id="netcreditsnotenough"><a class="header" href="#netcreditsnotenough">NetCreditsNotEnough</a></h3>
<p>Error thrown when the net credits are not enough.</p>
<pre><code class="language-solidity">error NetCreditsNotEnough();
</code></pre>
<h3 id="feesexceedrewards"><a class="header" href="#feesexceedrewards">FeesExceedRewards</a></h3>
<p>Error thrown when the fees exceed the rewards.</p>
<pre><code class="language-solidity">error FeesExceedRewards();
</code></pre>
<h3 id="feeexceedsmaximum"><a class="header" href="#feeexceedsmaximum">FeeExceedsMaximum</a></h3>
<p>Error thrown when a fee exceeds the maximum allowed</p>
<pre><code class="language-solidity">error FeeExceedsMaximum();
</code></pre>
<h3 id="invalidvault"><a class="header" href="#invalidvault">InvalidVault</a></h3>
<p>Error thrown when the vault is invalid</p>
<pre><code class="language-solidity">error InvalidVault();
</code></pre>
<h3 id="invalidharvestdatalength"><a class="header" href="#invalidharvestdatalength">InvalidHarvestDataLength</a></h3>
<p>Error thrown when harvest data length doesn't match vaults length</p>
<pre><code class="language-solidity">error InvalidHarvestDataLength();
</code></pre>
<h3 id="invalidprotocolcontroller"><a class="header" href="#invalidprotocolcontroller">InvalidProtocolController</a></h3>
<p>Error thrown when the protocol controller is invalid</p>
<pre><code class="language-solidity">error InvalidProtocolController();
</code></pre>
<h3 id="invalidrewardtoken"><a class="header" href="#invalidrewardtoken">InvalidRewardToken</a></h3>
<p>Error thrown when the reward token is invalid</p>
<pre><code class="language-solidity">error InvalidRewardToken();
</code></pre>
<h3 id="invalidprotocolid"><a class="header" href="#invalidprotocolid">InvalidProtocolId</a></h3>
<p>Error thrown when the protocol ID is invalid</p>
<pre><code class="language-solidity">error InvalidProtocolId();
</code></pre>
<h3 id="harvesttokennotreceived"><a class="header" href="#harvesttokennotreceived">HarvestTokenNotReceived</a></h3>
<p>Error thrown when the harvester has not transferred the correct amount of tokens to the Accountant contract</p>
<pre><code class="language-solidity">error HarvestTokenNotReceived();
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="vaultdata"><a class="header" href="#vaultdata">VaultData</a></h3>
<p>Tracks reward and supply data for each vault</p>
<p><em>Packed struct to minimize storage costs (3 storage slots)</em></p>
<pre><code class="language-solidity">struct VaultData {
    uint256 integral;
    uint128 supply;
    uint128 feeSubjectAmount;
    uint128 totalAmount;
    uint128 netCredited;
    uint128 reservedHarvestFee;
    uint128 reservedProtocolFee;
}
</code></pre>
<h3 id="accountdata"><a class="header" href="#accountdata">AccountData</a></h3>
<p>Tracks individual user positions within a vault</p>
<p><em>Integral tracking enables O(1) reward calculations</em></p>
<pre><code class="language-solidity">struct AccountData {
    uint128 balance;
    uint256 integral;
    uint256 pendingRewards;
}
</code></pre>
<h3 id="feesparams-1"><a class="header" href="#feesparams-1">FeesParams</a></h3>
<p>Struct that defines the fees parameters.</p>
<pre><code class="language-solidity">struct FeesParams {
    uint128 protocolFeePercent;
    uint128 harvestFeePercent;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/router/RouterModuleWithdraw.sol/contract.RouterModuleWithdraw.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../src/Allocator.sol/contract.Allocator.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/router/RouterModuleWithdraw.sol/contract.RouterModuleWithdraw.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../src/Allocator.sol/contract.Allocator.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../solidity.min.js"></script>


    </div>
    </body>
</html>
